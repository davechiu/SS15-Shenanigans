"use strict";function getURLParameter(sParam){for(var sPageURL=window.location.search.substring(1),sURLVariables=sPageURL.split("&"),i=0;i<sURLVariables.length;i++){var sParameterName=sURLVariables[i].split("=");if(sParameterName[0]===sParam)return sParameterName[1]}}var APP=window.APP=window.APP||{};APP.core={},APP.core.controller=function(){var _route="",setRoute=function(strVal){_route=strVal},getRoute=function(){return _route},executeRoute=function(){var ns=APP,route=getRoute(),action="init";""!==route&&ns[route]&&"function"==typeof ns[route][action]&&ns[route][action]()},init=function(){console.log("APP.controller.init");var routeName=document.querySelectorAll(".js-page-controller-action")[0].getAttribute("data-action-name");console.log("APP.controller.init | route name = "+routeName),setRoute(routeName),executeRoute()};return{init:init}}(),function(){for(var method,noop=function(){},methods=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],length=methods.length,console=window.console=window.console||{};length--;)method=methods[length],console[method]||(console[method]=noop)}();var secToMillisec=function(sec){return(1e3*sec).toFixed(0)},millisecToSec=function(msec){return(msec/1e3).toFixed(0)},secToMHS=function(sec){var newTime=new Date(0,0,0,0,0,0,0);newTime.setSeconds(sec);var output=newTime.getHours()+":"+(newTime.getMinutes()<10?"0":"")+newTime.getMinutes()+":"+(newTime.getSeconds()<10?"0":"")+newTime.getSeconds();return output},getRandomInt=function(min,max){return Math.floor(Math.random()*(max-min+1))+min},countUp=function(_elements,_numeral,_duration){$(_elements).each(function(){var $this=$(this);$({counter:0}).animate({counter:_numeral},{duration:_duration,easing:"linear",step:function(){$this.text(("undefined"!=typeof $this.data("prefix")?$this.data("prefix"):"")+(this.counter<10?0:"")+Math.ceil(this.counter))},complete:function(){$this.text(("undefined"!=typeof $this.data("prefix")?$this.data("prefix"):"")+_numeral)}})})},countDown=function(_elements,_numeral,_duration){$(_elements).each(function(){var $this=$(this);$({counter:_numeral}).animate({counter:0},{duration:_duration,easing:"linear",step:function(){$this.text(("undefined"!=typeof $this.data("prefix")?$this.data("prefix"):"")+(Math.ceil(this.counter)<10?0:"")+Math.ceil(this.counter))},complete:function(){$this.text(("undefined"!=typeof $this.data("prefix")?$this.data("prefix"):"")+"00")}})})},howLongAgoWasThisEpoch=function(_epoch){var humanReadableOutput,diffInMillisec=(new Date).getTime()-_epoch,dateDiff={inSeconds:parseInt(diffInMillisec/1e3),inMinutes:parseInt(diffInMillisec/6e4),inHours:parseInt(diffInMillisec/36e5),inDays:parseInt(diffInMillisec/864e5),inWeeks:parseInt(diffInMillisec/6048e5),inMonths:parseInt(diffInMillisec/2592e6),inYears:parseInt(diffInMillisec/31536e6),inEnglish:""};return humanReadableOutput=dateDiff.inSeconds<30?"just now":dateDiff.inSeconds>30&&0===dateDiff.inMinutes?dateDiff.inSeconds+" seconds ago":dateDiff.inMinutes>0&&0===dateDiff.inHours?dateDiff.inMinutes+" minutes ago":dateDiff.inHours>0&&0===dateDiff.inDays?dateDiff.inHours+" hours ago":dateDiff.inDays>0&&0===dateDiff.inWeeks?"about "+dateDiff.inDays+" days ago":dateDiff.inWeeks>0&&0===dateDiff.inMonths?"about "+dateDiff.inWeeks+" weeks ago":dateDiff.inMonths>0&&0===dateDiff.inYears?"about "+dateDiff.inMonths+" months ago":dateDiff.inYears>0?"about "+dateDiff.inYears+" years ago":"a long, long time ago.",dateDiff.inEnglish=humanReadableOutput,dateDiff},APP=window.APP=window.APP||{};APP.db=function(){var base="https://shenanigans.firebaseio.com",dataObj={},featuredVideosArr=[{videoId:"VWf8CXwPoqI",title:"PEOPLE ARE AWESOME 2014",source:"People are Awesome",sentiment:{question:"Is this awesome?",questalt:"Is that awesome?",positive:"Wicked!",negative:"Meh"}},{videoId:"kxIGlMrrhQM",title:"50 Common Misconceptions",source:"mental_floss",sentiment:{question:"Did you know that?",questalt:"How about this, did you know this?",positive:"No, crazy!",negative:"Obviously"}},{videoId:"cse5cCGuHmE",title:"President Obama's 2015 State of the Union Address",source:"The White House",sentiment:{question:"Do you agree with the President?",questalt:"Do you agree with the President?",positive:"Yes",negative:"No"}}],getFeaturedVideosArr=function(){return featuredVideosArr},update=function(ref,value){ref.update(value,onComplete)},set=function(ref,value){ref.set(value,onComplete)},push=function(ref,value){ref.push(value,onComplete)},getFbBase=function(){return base},getDataObj=function(){return dataObj},setDataObj=function(obj){$.extend(dataObj,obj)},onComplete=function(error){console.log(error?"Synchronization failed":"Synchronization succeeded")},init=function(){APP.video.setup()};return{init:init,getFbBase:getFbBase,setDataObj:setDataObj,getDataObj:getDataObj,getFeaturedVideosArr:getFeaturedVideosArr,set:set,push:push,update:update}}();var APP=window.APP=window.APP||{};APP.global=function(){var refresh=200,splitVideoParams=function(str){var vidStr=str.match(/^\w{2}_/);vidStr&&(APP.video.setVideoService(vidStr[0].slice(0,-1)),APP.video.setVideoId(str.substr(3,str.length)),APP.db.init())},easterEgg=function(){var kkeys=[],bananas="66,65,78,65,78,65,83";$(document).keydown(function(e){$(e.target).is("input, textarea")||(kkeys.push(e.keyCode),kkeys.toString().indexOf(bananas)>=0&&($(document).unbind("keydown"),window.location="?v=yt_nBJV56WUDng"))})},getRefresh=function(){return refresh},initGlobalComponents=function(){APP.user.init(),APP.video.init(),APP.sentiment.init(),APP.related.init(),APP.notification.init(),APP.modal.init()},initPageComponents=function(){APP.core.controller.init()},init=function(){var defaultVideoId="yt_VWf8CXwPoqI";if(splitVideoParams(window.getURLParameter("v")?window.getURLParameter("v"):defaultVideoId),initGlobalComponents(),initPageComponents(),easterEgg(),-1===APP.notification.checkIfRead("explainer")){var notificaitonHtml=$(document.createElement("p")).text("React lets you vote and comment on media in Warped Time, everyone experiences it as if it was being broadcasted live!");APP.notification.createNotification("explainer",notificaitonHtml)}};return{init:init,getRefresh:getRefresh}}(),$(document).ready(APP.global.init);var APP=window.APP=window.APP||{};APP.home=function(){var bindEventsToUI=function(){},init=function(){console.log("APP.home"),bindEventsToUI()};return{init:init}}();var APP=window.APP=window.APP||{};APP.user=function(){var uuid,fullName=null,userRef=new Firebase(APP.db.getFbBase()+"/users"),names=["Leroux","Bob","John","Yimmy","Nathan","Andrew","Harley","Catlin","Belammy","Lenny","Howard","Kenny","Louis","Amy","Ally","Alison","Jenifer","Bobby","Deandre","Betany","Joy","Lopez","Amilias","Courtney","Asha","Cindy","Camelea","Emily","Damon","Austin","Moure","Camy","Joana","Lizi","Steven","Pamela","Elizabeth","Marley","Jack","Jason","Johana","Alisha","Lisa","Joshua","Casandra","Mary","Catherin","Dashon","Camry","Diana","Jordan","Clark","Kyle","Brandon","David","Chewy","Betty","Erica","Jay","Precious","Finkle","5000","Horatio","Ignatious","Greta","Constance","Kimber","Al Gore","Taylor Swift","Pharrell","Giselle","Tom Brady"],adjs=["Awesome-O","Noxious","Chesty","Ablaze","Abrupt","Accomplished","Active","Adored","Adulated","Adventurous","Affectionate","Amused","Amusing","Animal-like","Antique","Appreciated","Archaic","Ardent","Arrogant","Astonished","Audacious","Authoritative","Awestruck","Beaming","Bewildered","Bewitching","Blissful","Boisterous","Booming","Bouncy","Breathtaking","Bright","Brilliant","Bubbling","Calm","Calming","Capricious","Celestial","Charming","Cheerful","Cherished","Chiaroscuro","Chilled","Comical","Commanding","Companionable","Confident","Contentment","Courage","Crazy","Creepy","Dancing","Dazzling","Delicate","Delightful","Demented","Desirable","Determined","Devoted","Dominant","Dramatic","Drawn out","Dripping","Dumbstruck","Ebullient","Elated","Elegant","Enchanted","Energetic","Enthusiastic","Ethereal","Exaggerated","Exalted","Expectant","Expressive","Exuberant","Faint","Fantastical","Favorable","Febrile","Feral","Feverish","Fiery","Floating","Flying","Folksy","Fond","Forgiven","Forgiving","Freakin awesome","Frenetic","Frenzied","Friendly Amorous","From a distance","Frosted","Funny","Furry","Galloping","Gaping","Gentle","Giddy","Glacial","Gladness","Gleaming","Gleeful","Gorgeous","Graceful","Grateful","Humble","Deflating","Halting","Happy","Haunting","Heavenly","Hidden","High-spirited","Honor","Hopeful","Hopping","Humble","Hushed","Hypnotic","Illuminated","Immense","Imperious","Impudent","In charge","Inflated","Innocent","Inspired","Intimate","Intrepid","Jagged","Joking","Joyful","Jubilant","Kindly","Languid","Larger than life","Laughable","Lickety-split","Lighthearted","Limping","Linear","Lively","Lofty","Love of","Lovely","Lulling","Luminescent","Lush","Luxurious","Magical","Maniacal","Manliness","March-like","Masterful","Merciful","Merry","Mischievous","Misty","Modest","Moonlit","Mysterious","Mystical","Mythological","Nebulous","Nostalgic","On fire","Overstated","Paganish","Pinching","Partying","Perfunctory","Perky","Perplexed","Persevering","Pious","Playful","Pleasurable","Poignant","Portentous","Posh","Powerful","Pretty","Prickly","Prideful","Princesslike","Proud","Puzzled","Queenly","Questing","Quiet","Racy","Ragged","Regal","Rejoicing","Relaxed","Reminiscent","Repentant","Reserved","Resolute","Ridiculous","Ritualistic","Robust","Running","Sarcastic","Scampering","Scoffing","Scurrying","Sensitive","Serene","Shaking","Shining","Silky","Silly","Simple","Singing","Skipping","Smooth","Sneaky","Soaring","Sophisticated","Sparkling","Spell-like","Spherical","Spidery","Splashing","Splendid","Spooky","Sprinting","Starlit","Starry","Startling","Successful","Summery","Surprised","Sympathetic","Tapping","Teasing","Tender","Thoughtful","Thrilling","Tingling","Tinkling","Tongue-in-cheek","Totemic","Touching","Tranquil","Treasured","Trembling","Triumphant","Twinkling","Undulating","Unruly","Urgent","Veiled","Velvety","Victorious","Vigorous","Virile","Walking","Wild","Witty","Wondering","Zealous","Zestful","Sweaty","Funky","Smarmy","Persnickety"],generateName=function(){var adj=adjs[window.getRandomInt(0,adjs.length)],name=names[window.getRandomInt(0,names.length)],fullName=adj+" "+name.charAt(0).toUpperCase()+name.slice(1);return fullName},updateUser=function(){uuid=getUUID();var updateUser=new Firebase(APP.db.getFbBase()+"/users/"+uuid);updateUser.update({name:fullName})},createUser=function(){var newChildRef=userRef.push();setUUID(newChildRef.key()),newChildRef.set({name:fullName})},setUUID=function(id){uuid=id,$.cookie("uuid",id)},getUUID=function(){var id=$.cookie("uuid");return id},getName=function(){return fullName},setName=function(str){fullName=str,$.cookie("name",str),"undefined"==typeof $.cookie("uuid")?createUser():($.cookie("uuid",uuid),updateUser())},initNametag=function(){$("#onboarding").fadeIn("fast"),$.browser.ios&&$(".content .video #player").hide();var tmpName=generateName();$(".nametag input#user_name").val(tmpName),$("input#posting-as").val(tmpName),$(".nametag input#user_name").on("click",function(){$(this).select()}),$(".nametag input#user_name").on("change keypress keyup",function(){$("input#posting-as").val($(".nametag input#user_name").val()),window.ga("send","event","textarea","name change","onboard")}),$(".nametag form#intake").on("submit",function(e){e.preventDefault(),$(".nametag input#user_name").val().length<=1?APP.modal.createModal("We're all friends here...","How about a longer name?","Fine","Pick For Me",function(){$(".nametag input#user_name").val(generateName()),nameTagHandler(),window.ga("send","event","submit","join the conversation","autopick")}):(nameTagHandler(),window.ga("send","event","submit","join the conversation","onboard"))})},nameTagHandler=function(){$.browser.ios&&$(".content .video #player").show(),$("#onboarding").fadeOut("fast"),$("input#posting-as").val($(".nametag input#user_name").val()),setName($(".nametag input#user_name").val()),window.player.playVideo()},init=function(){console.log("APP.user"),"undefined"==typeof $.cookie("name")?initNametag():setName($.cookie("name"))};return{init:init,generateName:generateName,setName:setName,getName:getName,getUUID:getUUID}}();var APP=window.APP=window.APP||{};APP.video=function(){var videoId,videoService,videoDuration,playerState,_=window._,videoRatio=.609375,videosRef=new Firebase(APP.db.getFbBase()+"/videos"),videoPercentageComplete=0,setup=function(){videosRef.child(videoId).once("value",function(snapshot){var exists=snapshot.exists();if(exists){var videoData={};videoData.videos={},videoData.videos[videoId]=snapshot.val(),APP.db.setDataObj(videoData)}else{var voteObj=(APP.video.getVideoId(),APP.sentiment.getVoteObj(0,0)),seedVideosRef=new Firebase(APP.db.getFbBase()+"/videos/"+videoId+"/0");APP.db.push(seedVideosRef,voteObj)}})},initYouTube=function(){var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);var videoWidth=$(".content .video").width(),videoHeight=$(".content .video").width()*videoRatio;window.onYouTubeIframeAPIReady=function(){window.player=new window.YT.Player("player",{height:videoHeight,width:videoWidth,videoId:APP.video.getVideoId(),playerVars:{modestbranding:1,autoplay:0,controls:0,rel:0,fs:0},events:{onReady:window.onPlayerReady,onStateChange:window.onPlayerStateChange}})},window.onPlayerReady=function(){"undefined"!=typeof $.cookie("name")&&document.referrer.indexOf(location.origin)>-1&&window.player.playVideo(),videoDuration=window.secToMillisec(window.player.getDuration().toFixed(1))},window.onPlayerStateChange=function(event){event.data===window.YT.PlayerState.PLAYING?(window.refreshIntervalId=setInterval(function(){var currentTime=(window.player.getDuration(),window.player.getCurrentTime());$.publish("/video/currentTime",window.secToMillisec(currentTime.toFixed(1)))},APP.global.getRefresh()),APP.video.setPlayerStatus("playing"),window.ga("send","event","video","playing","youtube",APP.video.getVideoId())):event.data===window.YT.PlayerState.PAUSED?(clearInterval(window.refreshIntervalId),APP.video.setPlayerStatus("paused"),window.ga("send","event","video","paused","youtube",APP.video.getVideoId())):event.data===window.YT.PlayerState.ENDED&&(clearInterval(window.refreshIntervalId),APP.video.setPlayerStatus("ended"),window.ga("send","event","video","ended","youtube",APP.video.getVideoId()),APP.video.openEndCard())},window.stopVideo=function(){window.player.stopVideo()}},resizeVideo=function($video){var videoWidth=$(".content .video").parent().width(),videoHeight=$(".content .video").parent().width()*videoRatio;$video.css({height:videoHeight,width:videoWidth}),$video.parent().css({height:videoHeight,width:videoWidth})},getVideoId=function(){return videoId},setVideoId=function(id){videoId=id},getVideoService=function(){return videoService},setVideoService=function(str){videoService=str},getVideoDuration=function(){return videoDuration},setPlayerStatus=function(str){playerState=str},getPlayerStatus=function(){return playerState},reportVideoCompletionPercentage=function(e,currentTick){var currVideoPercentageComplete=100*(currentTick/APP.video.getVideoDuration()).toFixed(1);currVideoPercentageComplete>videoPercentageComplete&&(videoPercentageComplete=currVideoPercentageComplete,window.ga("send","event","video","play-"+videoPercentageComplete,"youtube",APP.video.getVideoId()))},initEndCard=function(){var featuredIndex=_.findIndex(APP.db.getFeaturedVideosArr(),{videoId:APP.video.getVideoId()}),nextIndex=featuredIndex+1;nextIndex===APP.db.getFeaturedVideosArr().length&&(nextIndex=0);var nextVideoObj=APP.db.getFeaturedVideosArr()[nextIndex];$("#endcard .next .nextVideo").text(nextVideoObj.title),$("#endcard .play a").attr("href","?v=yt_"+nextVideoObj.videoId),$("#endcard .replay a").on("click",function(e){e.preventDefault(),APP.video.closeEndCard(),APP.video.replayVideo()})},openEndCard=function(){$("#endcard").fadeIn("fast"),window.countDown($("#endcard .nextCountdown"),15,15e3),window.nvt=setTimeout(function(){location.href=$("#endcard .play a").attr("href"),window.ga("send","event","endcard","next video","timer")},15e3),window.ga("send","event","video","endcard","opened")},replayVideo=function(){clearTimeout(window.nvt),window.player.seekTo(0),window.player.playVideo(),window.ga("send","event","video","replay","youtube",APP.video.getVideoId())},closeEndCard=function(){$("#endcard").fadeOut("fast")},init=function(){console.log("APP.video"),"yt"===videoService&&initYouTube(),APP.comments.init(),$(window).on("resize",function(){APP.video.resizeVideo($(".content .card .video iframe"))}),window.wt=setTimeout(function(){$(window).trigger("resize")},500),initEndCard()};return{init:init,setVideoId:setVideoId,getVideoId:getVideoId,setVideoService:setVideoService,getVideoService:getVideoService,getVideoDuration:getVideoDuration,setPlayerStatus:setPlayerStatus,getPlayerStatus:getPlayerStatus,resizeVideo:resizeVideo,replayVideo:replayVideo,closeEndCard:closeEndCard,openEndCard:openEndCard,reportVideoCompletionPercentage:reportVideoCompletionPercentage,setup:setup}}();var APP=window.APP=window.APP||{};APP.header=function(){var bindEventsToUI=function(){},init=function(){console.log("APP.header"),bindEventsToUI()};return{init:init}}();var APP=window.APP=window.APP||{};APP.sentiment=function(){var tempVoteValue,playerData,_=window._,newDataObj={},chartPlayerData=(new Firebase(APP.db.getFbBase()+"/videos"),[]),transformedArr=[],freshUserVoteSum=0,getNewDataObj=function(){var vidId=APP.video.getVideoId();return newDataObj[vidId]={votes:null},newDataObj},getVoteObj=function(interval,vote){var dataObj={};return dataObj={value:vote,time:interval,dt:(new Date).getTime()}},postVote=function(event,value){var interval=value,refVoteUrl=APP.db.getFbBase()+"/videos/"+APP.video.getVideoId()+"/"+interval,refVote=new Firebase(refVoteUrl);$.unsubscribe("/video/currentTime",APP.sentiment.postVote),APP.db.push(refVote,getVoteObj(interval,tempVoteValue))},bindVote=function(){$(".sentiment [data-value]").on("click",function(e){e.preventDefault(),"playing"===APP.video.getPlayerStatus()?(tempVoteValue=$(this).data("value"),$.subscribe("/video/currentTime",APP.sentiment.postVote),clearTimeout(window.t),window.t=setTimeout(function(){$("h1").toggleClass("alt")},2750),window.ga("send","event","vote",tempVoteValue>0?"positive":"negative",APP.video.getVideoId())):APP.modal.createModal("I know, right?","Unfortunately, we can only place your vote if the video is playing.","Pfft","Ok, Play Video",function(){window.player.playVideo()}),freshUserVoteSum+=tempVoteValue})},getChartData=function(){var playerDataUrl=APP.db.getFbBase()+"/videos/"+APP.video.getVideoId();playerData=new Firebase(playerDataUrl),playerData.on("child_added",function(playerDataSnapshot){_.transform(playerDataSnapshot.val(),function(result,num){var arrIndex=_.findIndex(chartPlayerData,{x:parseInt(num.time)});-1===arrIndex?chartPlayerData.push({x:parseInt(num.time),y:parseInt(num.value)}):chartPlayerData[arrIndex].y=chartPlayerData[arrIndex].y+num.value})})},getChartPlayerData=function(){return chartPlayerData},initChart=function(){window.Highcharts.setOptions({global:{useUTC:!1}}),$("#chart").highcharts({chart:{type:"spline",animation:window.Highcharts.svg,marginRight:0,marginLeft:0,events:{load:function(){var series=this.series[0],interval=0;setInterval(function(){if("playing"===APP.video.getPlayerStatus()){$(".sentiment .wrapper").is(":visible")||$(".sentiment .wrapper").slideDown("fast",function(){$("#chart").highcharts().reflow()});var tmpArr=getTransformedArr();if(!tmpArr.length||tmpArr[0].x!==interval&&0!==tmpArr[0].x)series.addPoint([interval,0+freshUserVoteSum]);else{var tmpVals=tmpArr.shift();setTransformedArr(tmpArr),series.addPoint([tmpVals.x,tmpVals.y+freshUserVoteSum])}"playing"===APP.video.getPlayerStatus()&&(interval+=100),freshUserVoteSum=0}},100)}}},title:{text:""},xAxis:{type:"linear",tickPixelInterval:150,labels:{enabled:!1},lineColor:"#EEEEEE",tickWidth:0},yAxis:{title:{text:""},plotLines:[{value:0,width:1,color:"#999999"},{value:-1,width:1,color:"#EFEFEF"},{value:1,width:1,color:"#EFEFEF"}],gridLineWidth:0,labels:{enabled:!1},tickPositioner:function(){var maxDeviation=Math.ceil(Math.max(Math.abs(this.dataMax),Math.abs(this.dataMin))),halfMaxDeviation=Math.ceil(maxDeviation/2);return[-maxDeviation,-halfMaxDeviation,0,halfMaxDeviation,maxDeviation]}},tooltip:{enabled:!1},plotOptions:{spline:{lineWidth:3,states:{hover:{lineWidth:3}},marker:{enabled:!1}}},legend:{enabled:!1},exporting:{enabled:!1},series:[{name:"Sentiment",data:[{x:0,y:0}]}],credits:{enabled:!1}})},getTransformedArr=function(){return transformedArr},setTransformedArr=function(arr){transformedArr=arr},getFreshUserVotes=function(){return freshUserVoteSum},initQnA=function(){var featuredIndex=_.findIndex(APP.db.getFeaturedVideosArr(),{videoId:APP.video.getVideoId()});if(featuredIndex>-1){var thisVideoObj=APP.db.getFeaturedVideosArr()[featuredIndex];$(".sentiment h1 .pri").text(thisVideoObj.sentiment.question),$(".sentiment h1 .alt").text(thisVideoObj.sentiment.questalt),$(".sentiment .actions a i.fa").remove(),$(".sentiment .actions a.positive").text(thisVideoObj.sentiment.positive),$(".sentiment .actions a.negative").text(thisVideoObj.sentiment.negative)}$(".sentiment .share").share({showShareCount:!1,networks:[{network:"twitter",display:$(document.createElement("i")).addClass("fa fa-twitter"),tweet:$(".sentiment h1 .pri").text()+" #React #StaticShowdown"}]})},init=function(){console.log("APP.sentiment"),bindVote(),getChartData(),window.delayedTimer=setTimeout(function(){setTransformedArr(getChartPlayerData()),initChart()},1500),initQnA()};return{init:init,getNewDataObj:getNewDataObj,getVoteObj:getVoteObj,getChartPlayerData:getChartPlayerData,postVote:postVote,getFreshUserVotes:getFreshUserVotes,getTransformedArr:getTransformedArr,setTransformedArr:setTransformedArr}}();var APP=window.APP=window.APP||{};APP.comments=function(){var videoId,tempCommentValue,currentTime,timeCache=[],lastTimeRef=0,commentRef=new Firebase(APP.db.getFbBase()+"/comments"),setup=function(){commentRef.child(videoId).once("value",function(snapshot){var exists=snapshot.exists();if(exists){var commentsData={};commentsData.comments={},commentsData.comments[videoId]=snapshot.val(),APP.db.setDataObj(commentsData)}else{var commentObj=getCommentObj(0,null),commentVideoRef=new Firebase(APP.db.getFbBase()+"/comments/"+videoId+"/0");APP.db.push(commentVideoRef,commentObj)}loadFeed()})},bindEventsToUI=function(){clearComment()},clearComment=function(){$("#post-comment").val("")},initPostForm=function(){null!==APP.user.getName()&&APP.user.getName().length&&$("input#posting-as").val(APP.user.getName()),$("a.mobileSubmit").on("click",function(e){e.preventDefault(),$("form#postcomment").trigger("submit"),$("input#post-comment").focus()}),$("form#postname").on("submit",function(e){e.preventDefault()}),$("input#posting-as").on("change",function(){$("input#posting-as").val().length<=1?APP.modal.createModal("We're all friends here...","How about a longer name?","Fine","Pick For Me",function(){$("input#posting-as").val(APP.user.generateName()),APP.user.setName($("input#posting-as").val()),window.ga("send","event","comment","name change autopick")}):(APP.user.setName($("input#posting-as").val()),window.ga("send","event","comment","name change"))})},loadFeed=function(){var commentFeedRef=new Firebase(APP.db.getFbBase()+"/comments/"+videoId);commentFeedRef.on("child_added",function(allCommentsSnapshot,prevChildName){allCommentsSnapshot.forEach(function(commentSnapshot){var key=commentSnapshot.key(),val=commentSnapshot.val();if(0!==val.time){var commentInstance={time:val.time,id:key};timeCache.push(commentInstance);var yourComment="";val.uuid===APP.user.getUUID()&&(yourComment=" yours");var storage="";if(0===lastTimeRef&&(storage=" storage"),void 0!==val.comment&&""!==val.comment&&null!==val.comment){var li='<li class="comment new'+yourComment+storage+'" data-cuid="'+key+'" data-time="'+val.time+'" data-dt="'+val.dt+'"><div class="wrapper"><div class="byline" data-when="'+window.howLongAgoWasThisEpoch(val.dt).inEnglish+'">'+val.name+" @"+window.secToMHS(window.millisecToSec(val.time))+'</div><div class="comment">'+val.comment+"</div></div></li>";0===lastTimeRef?$(".comment-feed ul").prepend(li):$(li).insertBefore($('[data-time="'+prevChildName+'"]')),setTimeout(function(){$(".comment-feed ul li.new:not(.storage)").removeClass("new")},150)}}})})},initCommentFeed=function(){$.subscribe("/video/currentTime",APP.comments.handleCurrentTime)},handleCurrentTime=function(e,v){triggerShowComment(),currentTime=v},triggerShowComment=function(){$("li.comment.storage").filter(function(){return $(this).data("time")>=currentTime-500&&$(this).data("time")<=currentTime}).removeClass("storage"),setTimeout(function(){$(".comment-feed ul li.new:not(.storage)").removeClass("new")},150),lastTimeRef=currentTime},getCommentObj=function(interval,comment){var dataObj={},getID=APP.user.getUUID(),getName=APP.user.getName();return dataObj={uuid:getID,name:getName,comment:comment,time:interval,dt:(new Date).getTime()}},postComment=function(event,value){var interval=value,commentRefUrl=APP.db.getFbBase()+"/comments/"+videoId+"/"+interval,refComment=new Firebase(commentRefUrl);$.unsubscribe("/video/currentTime",postComment),APP.db.push(refComment,getCommentObj(interval,tempCommentValue)),clearComment(),window.ga("send","event","comment","post")},bindComment=function(){$("form#postcomment").submit(function(event){event.preventDefault(),tempCommentValue=$("#post-comment").val(),$.subscribe("/video/currentTime",APP.comments.postComment),"playing"!==APP.video.getPlayerStatus()&&APP.modal.createModal("We hear you!","Unfortunately, we can only post your comment if the video is playing.","As If","Ok, Play Video",function(){window.player.playVideo()})})},getVideoId=function(){setVideoId(APP.video.getVideoId())},setVideoId=function(getVideoId){videoId=getVideoId},init=function(){console.log("APP.comments"),bindEventsToUI(),getVideoId(),setup(),bindComment(),initPostForm(),initCommentFeed()};return{init:init,setup:setup,postComment:postComment,handleCurrentTime:handleCurrentTime}}();var APP=window.APP=window.APP||{};APP.related=function(){var buildMarkup=function(){var featuredVideosArr=APP.db.getFeaturedVideosArr(),html="",playing="",href="";return $.each(featuredVideosArr,function(i,elem){href="?v=yt_"+elem.videoId,elem.videoId===APP.video.getVideoId()&&(playing='class="playing"',href="#"),html+="<li "+playing+' style="background-image: url(http://img.youtube.com/vi/'+elem.videoId+'/0.jpg);">',html+='<a href="'+href+'" data-videoid="'+elem.videoId+'">',html+='<i class="fa fa-youtube-play"></i>',html+='<div class="title">'+elem.title+"</div>",html+='<div class="source">'+elem.source+"</div></a>",html+="</li>",playing=""}),html},renderRelated=function(){$(".related ul").html(buildMarkup()),$(".related ul li a").on("click",function(){window.ga("send","event","related","click",$(this).data("videoid"))})},init=function(){console.log("APP.related"),renderRelated()};return{init:init}}();var APP=window.APP=window.APP||{};APP.notification=function(){var _=window._,messagesSeen=[],markAsRead=function(messageId){-1===_.indexOf(messagesSeen,messageId)&&(messagesSeen.push(messageId),$.cookie("messagesSeen",messagesSeen.join(",")))},checkIfRead=function(messageId){return _.indexOf(messagesSeen,messageId)},createNotification=function(messageId,html){var notification=$(document.createElement("div")).addClass("card").append($(document.createElement("div")).addClass("notification").data("messageId",messageId).append($(document.createElement("div")).addClass("wrapper").append($(document.createElement("a")).addClass("close fa fa-times").attr("href","#").on("click",function(e){e.preventDefault();var $notificationObj=$(this).closest(".notification");APP.notification.markAsRead($notificationObj.data("messageId")),window.ga("send","event","notification","close",$notificationObj.data("messageId")),$notificationObj.slideUp("fast")}),$(html))));$(".content").prepend(notification)},init=function(){console.log("APP.notification"),$.cookie("messagesSeen")&&(messagesSeen=$.cookie("messagesSeen").split(","))};return{init:init,createNotification:createNotification,markAsRead:markAsRead,checkIfRead:checkIfRead}}();var APP=window.APP=window.APP||{};APP.modal=function(){var openModal=function(){$(".modal").fadeIn(150)},closeModal=function(){$(".modal").fadeOut(150)},createModal=function(_title,_body,_cancelText,_okText,_okCallback){$(".modal .heading p strong").text(_title),$(".modal .copy p").text(_body),$(".modal .actions a.cancel").text(_cancelText),$(".modal .actions a.ok").text(_okText),$(".modal .actions a.ok").off("click"),$(".modal .actions a.ok").data("onclick",null),"function"==typeof _okCallback?($(".modal .actions a.ok").data("onclick",_okCallback),$(".modal .actions a.ok").on("click",function(e){e.preventDefault(),null!==$(this).data("onclick")&&$(this).data("onclick").call(this,e),window.ga("send","event","modal","ok: "+$(this).text()),APP.modal.closeModal()})):$(".modal .actions a.ok").on("click",function(e){e.preventDefault(),APP.modal.closeModal(),window.ga("send","event","modal","ok: "+$(this).text())}),openModal()},init=function(){console.log("APP.modal"),$(".modal .actions a.cancel").on("click",function(e){e.preventDefault(),APP.modal.closeModal(),window.ga("send","event","modal","cancel: "+$(this).text())})};return{init:init,createModal:createModal,closeModal:closeModal}}();
//# sourceMappingURL=main.map